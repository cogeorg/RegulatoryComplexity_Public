
  ___  ____  ____  ____  ____ ©
 /__    /   ____/   /   ____/      17.0
___/   /   /___/   /   /___/       SE—Standard Edition

 Statistics and Data Science       Copyright 1985-2021 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-STATA-PC        https://www.stata.com
                                   979-696-4600        stata@stata.com

Stata license: Single-user , expiring 16 May 2022
Serial number: 401709201735
  Licensed to: Co-Pierre Georg
               University of Cape Town

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. Maximum number of variables is set to 5,000; see help set_maxvar.

. do 12_complete_dictionaries.do 

. cd /home/co/git/RegulatoryComplexity_Public/200_analysis
/home/co/git/RegulatoryComplexity_Public/200_analysis

. 
. //
. // PREPARE COUNTS AND RESIDUALS (=UNMATCHED WORDS)
. //
. insheet using results/html/results_all_titles.csv, delimiter(";") clear
(3 vars, 21,953 obs)

.         rename v1 key

.         rename v2 category

.         rename v3 count

. 
.         sort key count

. 
.         egen id_key = group(key)

.         egen id_category = group(category)

. 
.         bysort id_category: egen category_count = sum(count)

.         bysort id_key: egen total_count = sum(count)

.         drop count

. duplicates drop key, force

Duplicates in terms of key

(15,839 observations deleted)

. 
.         bysort id_key: gen _duplicate = _N

.         gsort - _duplicate + id_key

. 
. outsheet using results/html/master_dict.csv, delimiter(";") replace

. 
. keep category category_count

. duplicates drop

Duplicates in terms of all variables

(6,107 observations deleted)

. 
.         gsort - category_count

. outsheet using results/html/category_count.csv, delimiter(";") replace

. 
. 
. //
. // CREATE RESULTS FOR INDIVIDUAL TITLES
. //
. forval i=1/16 {
  2. insheet using results/html/results_title_`i'.csv, delimiter(";") clear
  3.         rename v1 key
  4.         rename v2 category
  5.         rename v3 count
  6. 
.         sort key count
  7. 
.         egen id_key = group(key)
  8.         egen id_category = group(category)
  9. 
.         gen _one = 1
 10. 
.         bysort id_category: egen category_count = sum(count)
 11.         bysort id_category: egen category_unique_count = sum(_one)
 12. 
.         bysort id_key: egen total_count = sum(count)
 13. drop count _one
 14. 
.         bysort id_key: gen _duplicate = _N
 15.         gsort - _duplicate + id_key
 16. 
.         keep category category_count category_unique_count
 17. duplicates drop
 18. 
.         gsort category
 19. outsheet using results/html/category_count_title_`i'.csv, delimiter(";") r
> eplace        
 20. }
(3 vars, 1,730 obs)

Duplicates in terms of all variables

(1,723 observations deleted)
(3 vars, 1,863 obs)

Duplicates in terms of all variables

(1,856 observations deleted)
(3 vars, 1,279 obs)

Duplicates in terms of all variables

(1,272 observations deleted)
(3 vars, 660 obs)

Duplicates in terms of all variables

(653 observations deleted)
(3 vars, 1,013 obs)

Duplicates in terms of all variables

(1,006 observations deleted)
(3 vars, 1,449 obs)

Duplicates in terms of all variables

(1,442 observations deleted)
(3 vars, 2,866 obs)

Duplicates in terms of all variables

(2,859 observations deleted)
(3 vars, 890 obs)

Duplicates in terms of all variables

(883 observations deleted)
(3 vars, 2,813 obs)

Duplicates in terms of all variables

(2,806 observations deleted)
(3 vars, 2,942 obs)

Duplicates in terms of all variables

(2,935 observations deleted)
(3 vars, 862 obs)

Duplicates in terms of all variables

(855 observations deleted)
(3 vars, 320 obs)

Duplicates in terms of all variables

(313 observations deleted)
(3 vars, 214 obs)

Duplicates in terms of all variables

(207 observations deleted)
(3 vars, 2,092 obs)

Duplicates in terms of all variables

(2,085 observations deleted)
(3 vars, 635 obs)

Duplicates in terms of all variables

(628 observations deleted)
(3 vars, 73 obs)

Duplicates in terms of all variables

(66 observations deleted)

. 
. //
. // PREPARE FOR DICTIONARY MERGE LATER
. //
. forval i=1/16 {
  2. insheet using results/html/results_title_`i'.csv, delimiter(";") clear
  3.         rename v1 key
  4.         rename v2 category
  5.         drop v3
  6. save results/html/results_title_`i'.dta, replace
  7. }
(3 vars, 1,730 obs)
file results/html/results_title_1.dta saved
(3 vars, 1,863 obs)
file results/html/results_title_2.dta saved
(3 vars, 1,279 obs)
file results/html/results_title_3.dta saved
(3 vars, 660 obs)
file results/html/results_title_4.dta saved
(3 vars, 1,013 obs)
file results/html/results_title_5.dta saved
(3 vars, 1,449 obs)
file results/html/results_title_6.dta saved
(3 vars, 2,866 obs)
file results/html/results_title_7.dta saved
(3 vars, 890 obs)
file results/html/results_title_8.dta saved
(3 vars, 2,813 obs)
file results/html/results_title_9.dta saved
(3 vars, 2,942 obs)
file results/html/results_title_10.dta saved
(3 vars, 862 obs)
file results/html/results_title_11.dta saved
(3 vars, 320 obs)
file results/html/results_title_12.dta saved
(3 vars, 214 obs)
file results/html/results_title_13.dta saved
(3 vars, 2,092 obs)
file results/html/results_title_14.dta saved
(3 vars, 635 obs)
file results/html/results_title_15.dta saved
(3 vars, 73 obs)
file results/html/results_title_16.dta saved

. 
. use results/html/results_title_1.dta, clear

. forval i=2/16 {
  2.         append using results/html/results_title_`i'.dta
  3. }
(variable key was str18, now str22 to accommodate using data's values)

. duplicates drop key, force

Duplicates in terms of key

(15,591 observations deleted)

. 
. //
. // CHECK RESIDUALS
. //
. 
. // prepare master dict
. insheet using ./results/Master_clean.csv, clear
(2 vars, 14,939 obs)

.         rename v1 missing_key 

.         rename v2 category

. save ./results/Master_clean.dta, replace
file ./results/Master_clean.dta saved

. 
. // prepare residuals + merge
. insheet using results/html/residual_all_titles.txt, delimiter(" ") clear
(1 var, 24,979 obs)

.         rename v1 missing_key

.         duplicates drop

Duplicates in terms of all variables

(20,340 observations deleted)

.         gsort - missing_key

. save results/html/residual_all_titles.dta, replace
file results/html/residual_all_titles.dta saved

. 
. merge 1:1 missing_key using ./results/Master_clean.dta
(variable missing_key was str26, now str203 to accommodate using data's
       values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                        16,034
        from master                     2,867  (_merge==1)
        from using                     13,167  (_merge==2)

    Matched                             1,772  (_merge==3)
    -----------------------------------------

.         drop if _merge == 2
(13,167 observations deleted)

.         drop _merge 

. outsheet using ./results/html/residuals_matched.csv, replace

. 
. //
. // RUN THIS AFTER MANUALLY COMPLETING THE ABOVE FILE
. //
. insheet using ./results/html/residuals_matched+manually_completed.csv, clear
(2 vars, 7,472 obs)

.         rename v1 missing_key

.         rename v2 category

.         
.         // counting how many entries haven't been found
. //      gen foo = 1 if category == ""
. //      gen total = sum(foo)
.         // result: 1749
. //      drop foo total
. save ./results/html/residuals_matched+manually_completed.dta, replace
file ./results/html/residuals_matched+manually_completed.dta saved

. 
. 
. //
. // COMPLETE NEW MASTER DICTIONARY
. //
. use ./results/Master_clean.dta, clear

.         rename missing_key key

.         
. forval i=1/16 {
  2.         append using results/html/results_title_`i'.dta
  3. }

. 
. duplicates drop

Duplicates in terms of all variables

(18,407 observations deleted)

. duplicates drop key, force

Duplicates in terms of key

(130 observations deleted)

.         sort category key

. save ./results/Master_extended.dta, replace
file ./results/Master_extended.dta saved

. outsheet using ./results/Master_extended.csv, delimiter(";") replace

. 
end of do-file
